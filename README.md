# Sport Activity Tracker Scaffold

這是一個使用 Node.js + Express 建置的簡易運動紀錄網站雛形，前端以單頁式介面呈現，
方便快速驗證功能。使用者登入後可以新增運動紀錄、上傳照片、選擇是否公開分享，
並在儀表板上查看天氣資訊與運動日曆。

**🆕 最新功能**：支援左右滑動切換頁面，提供更流暢的行動裝置體驗！

## 快速開始

### 系統需求
- Node.js 14.0 或以上
- npm 6.0 或以上
- 現代化的網頁瀏覽器（支援觸控事件）

### 安裝與執行

```bash
# 安裝依賴套件
npm install

# 開發模式（使用 nodemon 自動重啟）
npm run dev

# 生產模式
npm start
```

啟動後瀏覽 <http://localhost:3000>：

- 可使用預設帳密登入：帳號 `athlete` / 密碼 `123456`
- 也可以在首頁註冊新帳號；註冊成功後請改用該帳號登入
- 新增紀錄時支援照片上傳（常見圖片格式、大小 5 MB 以內）
- 儀表板顯示天氣資訊，目前伺服器在 `fetchWeatherForUser` 中預留串接第三方 API 的位置，尚未串接時會顯示「天氣」占位
- 「運動日曆」會以月曆標記有紀錄的日期，點選即可查看當日摘要
- 新增紀錄可勾選「分享到社群牆」，公開的紀錄會在所有使用者的社群列表呈現
- 個人紀錄列表支援編輯與刪除，編輯完成後會同步更新日曆與社群分享
- **滑動功能**：在行動裝置上可用左右滑動切換頁面，同時保留原有按鈕切換功能

## 專案結構與檔案說明

```
sport1/
├── public/                          # 前端靜態資源
│   ├── css/
│   │   ├── styles.css              # 主要樣式表（1874 行）
│   │   │                           # 包含：
│   │   │                           #   - 配色方案定義（藍灰/奶油/深青/玫瑰色）
│   │   │                           #   - 響應式布局（header/sidebar/main/footer）
│   │   │                           #   - 表單、卡片、按鈕樣式
│   │   │                           #   - 日曆與列表樣式
│   │   │                           #   - 動畫與過渡效果
│   │   └── swipe.css               # 滑動切換功能的樣式（新增）
│   │                               # 包含：
│   │                               #   - 滑動容器與包裝器
│   │                               #   - 視圖變換動畫
│   │                               #   - 觸控相關的 CSS 最佳化
│   ├── js/
│   │   ├── app.js                  # 前端應用主程式（1424 行）
│   │   │                           # 主要功能模組：
│   │   │                           #   1. LocalStorage 工具函數（用戶認證信息）
│   │   │                           #   2. 身份認證（登入/註冊/登出）
│   │   │                           #   3. 活動 CRUD 操作（新增/編輯/刪除/查詢）
│   │   │                           #   4. 表單驗證與錯誤處理
│   │   │                           #   5. 日曆生成與日期標記
│   │   │                           #   6. 社群牆顯示（公開活動列表）
│   │   │                           #   7. 天氣資訊展示
│   │   │                           #   8. 照片上傳與管理
│   │   │                           #   9. UI 狀態管理與頁面切換
│   │   └── swipe-navigator.js      # 滑動導航控制器（新增）
│   │                               # 主要功能：
│   │                               #   - 監聽觸控事件 (touchstart/move/end)
│   │                               #   - 計算滑動距離與方向
│   │                               #   - 判別滑動 vs 滾動
│   │                               #   - 與原有的按鈕切換整合
│   │                               #   - 提供平滑的過渡動畫
│   ├── index.html                  # 單頁應用主入口（341 行）
│   │                               # 主要結構：
│   │                               #   - 固定 header（標題、用戶頭像、側邊欄）
│   │                               #   - 側邊欄導航與登出按鈕
│   │                               #   - 登入/註冊表單卡片
│   │                               #   - 應用主頁面（登入後顯示）
│   │                               #   - 活動表單（新增/編輯）
│   │                               #   - 活動列表與社群牆
│   │                               #   - 日曆容器
│   │                               #   - 天氣資訊卡片
│   ├── history.html                # 活動歷史頁面（獨立參考頁面）
│   ├── sports-list.txt             # 支援的運動類型列表
│   ├── images/                     # 圖片資源目錄
│   │                               # 包含：應用 Logo、圖標等
│   └── uploads/                    # 用戶上傳的活動照片目錄
│                                   # 命名規則：activity-[userId]-[timestamp]-[random].ext
│
├── src/
│   └── server.js                   # Express 後端伺服器（523 行）
│                                   # 主要功能模組：
│                                   #   1. 中間件設置（morgan 日誌、express.json、靜態文件）
│                                   #   2. 文件上傳配置（multer）
│                                   #   3. 內存數據存儲（模擬數據庫）
│                                   #   4. 用戶管理
│                                   #   5. 身份驗證與會話管理
│                                   #   6. 活動 API 端點
│                                   #   7. 天氣 API 端點（預留位置）
│                                   #   8. 文件清理函數
│
├── package.json                    # 項目配置與依賴
│                                   # 依賴：
│                                   #   - express 5.1.0 （Web 框架）
│                                   #   - morgan 1.10.1 （HTTP 請求日誌）
│                                   #   - multer 2.0.2 （文件上傳處理）
│                                   # 開發依賴：
│                                   #   - nodemon 3.1.10 （自動重啟）
│
├── README.md                       # 本文件
├── QUICK_REFERENCE.md              # 快速參考指南（API 端點、常用代碼）
├── CODE_SNIPPETS.md                # 代碼片段示例
├── DEMO_GUIDE.md                   # 演示指南
├── BOTTOM_SHEET_FEATURE.md         # 功能設計文檔
└── .vscode/                        # VS Code 開發者設置（可選）
```

## 核心功能說明

### 1. 用戶認證流程

**登入/註冊流程** (`src/server.js` + `public/js/app.js`):
- 用戶可以在前端進行登入或註冊
- 成功後服務器返回身份驗證令牌與用戶信息
- 使用 localStorage 存儲令牌，用於後續 API 調用
- 登出時清除 localStorage 的所有認證信息

**默認測試帳號**:
- 用戶名：`athlete`
- 密碼：`123456`

### 2. 活動管理 (CRUD)

**新增活動**:
- 用戶填寫表單：日期、運動類型、時長、強度、備註、照片
- 選擇是否公開分享到社群牆
- 照片由 multer 上傳到 `public/uploads/` 目錄

**查詢活動**:
- 個人列表：顯示當前登入用戶的所有活動
- 社群牆：顯示所有公開活動（跨用戶）
- 日曆視圖：按月份顯示有活動的日期

**編輯活動**:
- 點擊列表項進入編輯模式
- 修改各個字段（包括重新上傳照片）
- 保存時同步更新日曆與社群牆

**刪除活動**:
- 支援單個刪除或批量操作
- 刪除時自動清理關聯的上傳照片

### 3. 日曆功能

- 以月視圖呈現
- 標記有活動的日期
- 點擊日期查看該天的活動摘要
- 支援上下月切換

### 4. 天氣整合

- 儀表板顯示位置、溫度、天氣狀況、額外信息
- 當前為占位符，`fetchWeatherForUser` 方法已預留待整合真實 API

### 5. 滑動導航（新增功能）

**原理**:
- 監聽觸控事件：touchstart / touchmove / touchend
- 計算手指滑動的距離與方向
- 區分滑動操作 vs 垂直滾動
- 觸發對應的視圖切換

**使用方式**:
- 在行動裝置上，左右滑動即可切換頁面
- 垂直滾動不受影響，可正常查看內容
- 滑動距離小於設定閾值（50px）時不切換
- 仍可使用原有的按鈕進行頁面切換

**技術細節** (`public/js/swipe-navigator.js`):
- SwipeNavigator 類管理所有滑動邏輯
- 自動檢測 `.guest-view` 和 `.user-view` 視圖
- 使用 CSS transform 實現平滑動畫
- 與原有的視圖切換按鈕完全整合

## API 端點概覽

### 認證相關
- `POST /api/auth/register` - 用戶註冊
- `POST /api/auth/login` - 用戶登入
- `POST /api/auth/logout` - 用戶登出

### 活動相關
- `POST /api/activities` - 新增活動（支援照片上傳）
- `GET /api/activities` - 獲取當前用戶的活動列表
- `GET /api/activities/public` - 獲取所有公開活動
- `PUT /api/activities/:id` - 編輯指定活動
- `DELETE /api/activities/:id` - 刪除指定活動

### 天氣相關
- `GET /api/weather` - 獲取天氣信息（當前為占位）

## 開發工作流

### 運行模式

```bash
# 開發模式：使用 nodemon，文件變更時自動重啟
npm run dev

# 生產模式：直接使用 Node.js 運行
npm start

# 運行測試（當前為占位）
npm test
```

### 修改清單

**如果需要修改認證邏輯**:
- 編輯 `src/server.js` 中的 `POST /api/auth/login` 和 `POST /api/auth/register` 端點
- 更新 `public/js/app.js` 中的登入/註冊表單處理

**如果需要修改樣式**:
- 主要樣式在 `public/css/styles.css` 中修改
- 滑動相關樣式在 `public/css/swipe.css` 中修改
- 顏色方案定義在 CSS 根變量中（`:root`）

**如果需要添加新的活動字段**:
1. 更新 HTML 表單（`public/index.html`）
2. 更新前端驗證邏輯（`public/js/app.js`）
3. 更新後端 API（`src/server.js`）
4. 更新數據模型存儲

**如果需要修改滑動功能**:
- 編輯 `public/js/swipe-navigator.js`
- 調整 `minSwipeDistance` 值改變滑動靈敏度
- 修改 CSS 中的過渡時間改變動畫速度

## 下一步建議

### 數據持久化
- [ ] 將用戶與活動數據遷移至 MongoDB 或 PostgreSQL
- [ ] 實施數據庫索引優化查詢性能

### 安全性加強
- [ ] 使用 bcrypt 進行密碼加密存儲
- [ ] 實施 JWT 或會話型認證流程
- [ ] 添加 CORS 跨域資源共享配置
- [ ] 實施速率限制（rate limiting）

### 功能擴展
- [ ] 串接真實天氣 API（如 OpenWeatherMap）
- [ ] 添加社交功能（關注用戶、點贊活動）
- [ ] 實施運動統計與數據分析
- [ ] 添加推送通知功能
- [ ] 支援更多運動類型與自定義類型

### 性能與質量
- [ ] 編寫自動化測試（單元測試、集成測試）
- [ ] 實施 CI/CD 流程
- [ ] 優化圖片上傳與存儲（使用 CDN）
- [ ] 添加錯誤追蹤與日誌系統
- [ ] 進行性能基準測試

### 部署與維護
- [ ] 配置容器化部署（Docker）
- [ ] 設置環境變量管理（.env 文件）
- [ ] 編寫 API 文檔（使用 Swagger/OpenAPI）
- [ ] 制定備份與恢復策略

## 貢獻者指南

### 提交代碼前的檢查清單
- [ ] 確保代碼不破壞現有功能
- [ ] 運行 `npm run dev` 在本地測試
- [ ] 檢查控制台是否有錯誤或警告
- [ ] 更新相應的文檔
- [ ] 測試在行動裝置上的滑動功能

### 文件命名規範
- JavaScript 文件：使用小寫加連字符（如 `swipe-navigator.js`）
- CSS 文件：使用小寫加連字符（如 `swipe.css`）
- HTML 文件：使用小寫加連字符（如 `index.html`）

## 常見問題排除

**Q: 滑動功能在瀏覽器上不工作？**
A: 滑動功能需要觸控設備或在瀏覽器開發者工具中啟用觸控模擬。確保使用了支援觸控事件的現代瀏覽器。

**Q: 上傳的照片在哪裡？**
A: 照片存儲在 `public/uploads/` 目錄。文件名格式為 `activity-[userId]-[timestamp]-[random].ext`。

**Q: 如何更改默認端口？**
A: 修改 `src/server.js` 中的 `PORT` 變量，或設置環境變量 `PORT=5000`。

**Q: 如何重置所有數據？**
A: 由於當前使用內存存儲，重啟伺服器即可重置所有用戶和活動數據。
